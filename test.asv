% ztmp=zeros(2,4,5,6,7);
% for i=1:2
%     for j=1:4
%         ztmp(i,j,:,:,:)=ttt(tensor(squeeze(x(i,j,:,:,:))),tensor(squeeze(y(:,:,j,i))),[1],[1]);
%     end
% end

% ave=average_init(parameters);

V2_expand=permute(repmat(V2,1,1,1,NQ,NQ,2,2),[1,2,4,5,3,6,7]);
delta_tensor_expand=permute(repmat(delta_tensor,1,1,1,1,N,2,2),[5,1,2,3,4,6,7]);
ave2_expand=permute(repmat(ave2,1,1,1,1,N,NQ,NQ),[5,1,6,2,7,3,4]);
sum(V2_expand.*delta_tensor_expand.*ave2_expand,2,5)

